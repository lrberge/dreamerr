<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Checks arguments and informs the user appropriately — check_arg • dreamerr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Checks arguments and informs the user appropriately — check_arg"><meta property="og:description" content="Full-fledged argument checking. Checks that the user provides arguments of the requested type (even complex) in a very simple way for the developer. Provides detailed and informative error messages for the user."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dreamerr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/dreamerr_introduction.html">dreamerr: Error Handling Made Easy</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/lrberge/dreamerr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Checks arguments and informs the user appropriately</h1>
    <small class="dont-index">Source: <a href="https://github.com/lrberge/dreamerr/blob/HEAD/R/check_arg.R" class="external-link"><code>R/check_arg.R</code></a></small>
    <div class="hidden name"><code>check_arg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Full-fledged argument checking. Checks that the user provides arguments of the requested type (even complex) in a very simple way for the developer. Provides detailed and informative error messages for the user.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">check_arg</span><span class="op">(</span></span>
<span>  <span class="va">.x</span>,</span>
<span>  <span class="va">.type</span>,</span>
<span>  <span class="va">.x1</span>,</span>
<span>  <span class="va">.x2</span>,</span>
<span>  <span class="va">.x3</span>,</span>
<span>  <span class="va">.x4</span>,</span>
<span>  <span class="va">.x5</span>,</span>
<span>  <span class="va">.x6</span>,</span>
<span>  <span class="va">.x7</span>,</span>
<span>  <span class="va">.x8</span>,</span>
<span>  <span class="va">.x9</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">.message</span>,</span>
<span>  .choices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">.value</span>,</span>
<span>  <span class="va">.env</span>,</span>
<span>  .up <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">check_set_arg</span><span class="op">(</span></span>
<span>  <span class="va">.x</span>,</span>
<span>  <span class="va">.type</span>,</span>
<span>  <span class="va">.x1</span>,</span>
<span>  <span class="va">.x2</span>,</span>
<span>  <span class="va">.x3</span>,</span>
<span>  <span class="va">.x4</span>,</span>
<span>  <span class="va">.x5</span>,</span>
<span>  <span class="va">.x6</span>,</span>
<span>  <span class="va">.x7</span>,</span>
<span>  <span class="va">.x8</span>,</span>
<span>  <span class="va">.x9</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">.message</span>,</span>
<span>  .choices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">.value</span>,</span>
<span>  <span class="va">.env</span>,</span>
<span>  .up <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">check_value</span><span class="op">(</span></span>
<span>  <span class="va">.x</span>,</span>
<span>  <span class="va">.type</span>,</span>
<span>  <span class="va">.message</span>,</span>
<span>  <span class="va">.arg_name</span>,</span>
<span>  <span class="va">.prefix</span>,</span>
<span>  .choices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">.value</span>,</span>
<span>  <span class="va">.env</span>,</span>
<span>  .up <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">check_set_value</span><span class="op">(</span></span>
<span>  <span class="va">.x</span>,</span>
<span>  <span class="va">.type</span>,</span>
<span>  <span class="va">.message</span>,</span>
<span>  <span class="va">.arg_name</span>,</span>
<span>  <span class="va">.prefix</span>,</span>
<span>  .choices <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">.value</span>,</span>
<span>  <span class="va">.env</span>,</span>
<span>  .up <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">check_arg_plus</span></span>
<span></span>
<span><span class="va">check_value_plus</span></span></code></pre></div>
    </div>

    <div id="format">
    <h2>Format</h2>
    <p>An object of class <code>function</code> of length 1.</p>
<p>An object of class <code>function</code> of length 1.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>.x</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.type</dt>
<dd><p>A character string representing the requested type(s) of the arguments.
This is a bit long so please look at the details section or the vignette for explanations.
Each type is composed of one main class and restrictions (optional).
Types can be separated with pipes (<code>|</code>).
The main classes are: i) <code>"scalar"</code> for scalars, i.e. vectors of length one,
ii) <code>"vector"</code>, iii) <code>"matrix"</code>, iv) <code>"data.frame"</code>,
v) <code>"list"</code>, vi) <code>formula</code>, vii) <code>function</code>, viii) <code>charin</code>,
i.e. a character string in a set of choices, ix) <code>"match"</code>,
i.e. a character scalar that should partially match a vector of choices,
x) <code>path</code>, a character scalar pointing to a file or directory,
xi) <code>"class(my_class1, my_class2)"</code>, i.e. an object whose class is any
of the ones in parentheses, xii) <code>"NA"</code>, something identical to <code>NA</code>.
You can then add optional restrictions: 1) <code>len(a, b)</code>, i.e. the object
should be of length between <code>a</code> and <code>b</code> (you can leave <code>a</code>
or <code>b</code> missing, <code>len(a)</code> means length <em>equal</em> to <code>a</code>),
<code>len(data)</code> and <code>len(value)</code> are also possible (see details),
2) <code>nrow(a,b)</code> or <code>ncol(a,b)</code> to specify the expected number of
rows or columns, 3) <code>arg(a,b)</code>, only for functions, to retrict the number
of arguments, 4) <code>"na ok"</code> to allow the object to have NAs (for "scalar" types),
or <code>"no na"</code> to restrict the object to have no NA (for "data.frame", "vector",
and "matrix" types), 5) <code>GE</code>, <code>GT</code>, <code>LE</code> and <code>LT</code>:
for numeric scalars/vectors/matrices, <code>GE{expr}</code> restrics the object
to have only values striclty greater than (greater or equal/strictly lower
than/lower or equal) the value in curly brackets, 6) e.g. <code>scalar(type1, type2)</code>,
for scalars/vectors/matrices you can restrict the type of the object by
adding the expected type in parentheses: should it be numeric, logical, etc.</p></dd>


<dt>.x1</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x2</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x3</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x4</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x5</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x6</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x7</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x8</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>.x9</dt>
<dd><p>An argument to be checked. Must be an argument name. Can also be the type, see details/examples.</p></dd>


<dt>...</dt>
<dd><p>Only used to check <code>'...'</code> (dot-dot-dot) arguments.</p></dd>


<dt>.message</dt>
<dd><p>A character string, optional. By default, if the user provides a
wrong argument, the error message stating what type of argument is required is
automatically formed. You can alternatively provide your own error message,
maybe more tailored to your function. The reason of why there is a problem is
appended in the end of the message. You can use the special character
<code>__ARG__</code> in the message. If found, <code>__ARG__</code> will be
replaced by the appropriate argument name. Note that this message is interpolated with <code>string_magic()</code>.</p></dd>


<dt>.choices</dt>
<dd><p>Only if one of the types (in argument <code>type</code>) is <code>"match"</code>. The values the argument can take. Note that even if the <code>type</code> is <code>"match"</code>, this argument is optional since you have other ways to declare the choices.</p></dd>


<dt>.data</dt>
<dd><p>Must be a data.frame, a list or a vector. Used in three situations. 1) if the global keywords <code>eval</code> or <code>evalset</code> are present: the argument will also be evaluated in the data (i.e. the argument can be a variable name of the data set). 2) if the argument is expected to be a formula and <code>var(data)</code> is included in the type: then the formula will be expected to contain variables from <code>.data</code>. 3) if the keywords <code>len(data)</code>, <code>nrow(data)</code> or <code>ncol(data)</code> are requested, then the required length, number of rows/columns, will be based on the data provided in <code>.data</code>.</p></dd>


<dt>.value</dt>
<dd><p>An integer scalar or a named list of integers scalars. Used when the keyword <code>value</code> is present (like for instance in <code>len(value)</code>). If several values are to be provided, then it must be a named list with names equal to the codes: for instance if <code>nrow(value)</code> and <code>ncol(value)</code> are both present in the type, you can use (numbers are an example) <code>.value = list(nrow = 5, ncol = 6)</code>. See Section IV) in the examples.</p></dd>


<dt>.env</dt>
<dd><p>An environment defaults to the frame where the user called the original function. Only used in two situations. 1) if the global keywords <code>eval</code> or <code>evalset</code> are present: the argument will also be evaluated in this environment. 2) if the argument is expected to be a formula and <code>var(env)</code> is included in the type: then the formula will be expected to contain variables existing in <code>.env</code>.</p></dd>


<dt>.up</dt>
<dd><p>Integer, default is 0. If the user provides a wrong argument, the error message will integrate the call of the function from which <code>check_arg</code> has been called. If <code>check_arg</code> is  called in a non-user level sub function of a main user-level function, then use <code>.up = 1</code> to make the error message look like it occured in the main function (and not in the sub function). Of course you can have values higher than 1.</p></dd>


<dt>.arg_name</dt>
<dd><p>A character scalar. If <code>.message</code> is not provided, an automatic error message will be generated using <code>.arg_name</code> as the argument name. The structure of the message will be <code>"Argument '[.arg_name]' must be [requested type]. Problem: [detail of the problem]"</code>.</p></dd>


<dt>.prefix</dt>
<dd><p>A character scalar. If <code>.message</code> is not provided, an automatic error message will be generated. The structure of the message will be <code>"[.prefix] must be [requested type]. Problem: [detail of the problem]"</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>In case the <code>type</code> is <code>"match"</code>, it returns the matched value. In any other case, <code>NULL</code> is returned.</p>
    </div>
    <div id="functions">
    <h2>Functions</h2>
    
<ul><li><p><code>check_set_arg()</code>: Same as <code>check_arg</code>, but includes in addition: i) default setting, ii) type conversion, iii) partial matching, and iv) checking list elements. (Small drawback: cannot be turned off.)</p></li>
<li><p><code>check_value()</code>: Checks if a (single) value is of the appropriate type</p></li>
<li><p><code>check_set_value()</code>: Same as <code>check_value</code>, but includes in addition: i) default setting, ii) type conversion, iii) partial matching, and iv) checking list elements. (Small drawback: cannot be turned off.)</p></li>
</ul></div>
    <div id="how-to-form-a-type">
    <h2>How to form a type</h2>
    


<p>To write the expected type of an argument, you need to write the main class in combination with the class's options and restrictions (if any).</p>
<p>The syntax is: <code>"main_class option(s) restriction(s)"</code></p>
<p>A type MUST have at least one main class. For example: in the type <code>"logical vector len(,2) no na"</code>, <code>vector</code> is the main class, <code>no na</code> is the option, and <code>logical</code> and <code>len(,2)</code> are restrictions</p>
<p>There are 14 main classes that can be checked. On the left the keyword, on the right what is expected from the argument, and in square brackets the related section in the examples:</p><ul><li><p><code>scalar</code>: an atomic vector of length 1 [Section I)]</p></li>
<li><p><code>vector</code>: an atomic vector [Section IV)]</p></li>
<li><p><code>matrix</code>: a matrix [Section IV)]</p></li>
<li><p><code>vmatrix</code>: a matrix or vector [Section IV)]</p></li>
<li><p><code>data.frame</code>: a data.frame [Section VI)]</p></li>
<li><p><code>vdata.frame</code>: a data.frame or vector [Section VI)]</p></li>
<li><p><code>list</code>: a list [Section V)]</p></li>
<li><p><code>formula</code>: a formula [Section VIII)]</p></li>
<li><p><code>function</code>: a function [Section V)]</p></li>
<li><p><code>charin</code>: a character vector with values in a vector of choices [Section III)]</p></li>
<li><p><code>match</code>: a character vector with values in a vector of choices, partial matching enabled and only available in <code>check_set_arg</code> [Section III)]</p></li>
<li><p><code>path</code>: a character scalar pointing to a file or a directory</p></li>
<li><p><code>class</code>: a custom class [Section VI)]</p></li>
<li><p><code>NA</code>: a vector of length 1 equal to NA--does not support options nor restrictions, usually combined with other main classes (see Section on combining multiple types) [Section VI)]</p></li>
</ul><p>There are eight type options, they are not available for each types. Here what they do and the types to which they are associated:</p><ul><li><p><code>NA OK</code> (or <code>NAOK</code>): Tolerates the presence of NA values. Available for <code>scalar</code>.</p></li>
<li><p><code>NO NA</code> (or <code>NONA</code>): Throws an error if NAs are present. Available for <code>vector</code>, <code>matrix</code>, <code>vmatrix</code>, <code>data.frame</code>, and <code>vdata.frame</code>.</p></li>
<li><p><code>square</code>: Enforces the matrix to be square. Available for <code>matrix</code>, <code>vmatrix</code>.</p></li>
<li><p><code>named</code>: Enforces the object to have names. Available for <code>vector</code>, <code>list</code>.</p></li>
<li><p><code>multi</code>: Allows multiple matches. Available for <code>charin</code>, <code>match</code>.</p></li>
<li><p><code>strict</code>: Makes the matching case-sensitive. Available for <code>match</code>.</p></li>
<li><p><code>os</code> and <code>ts</code>: Available for <code>formula</code>. Option <code>os</code> (resp. <code>ts</code>) enforces that the formula is one-sided (resp. two-sided).</p></li>
<li><p><code>dir</code>, <code>read</code> and <code>create</code>: Available for <code>path</code>. Option <code>dir</code> checks whether the path points to a directory and not a file. Option <code>read</code> checks whether the file actually exists and has read permission. Option <code>create</code> creates up to the grand-parent folder if it was not yet existing.</p></li>
</ul><p>You can further add restrictions. There are roughly six types of restrictions. Here what they do and the types to which they are associated:</p><ul><li><p>sub-type restriction: For atomic types (<code>scalar</code>, <code>vector</code>, <code>matrix</code> or <code>vmatrix</code>), you can restrict the underlying data to be of a specific sub-type. The simple sub-types are: i) <code>integer</code> (numeric without decimals and logicals), i') <code>strict integer</code> (numeric that can be converted to integer with <code>as.integer</code>, and not logicals), ii) <code>numeric</code>, iii) <code>factor</code>, iv) <code>logical</code> and iv') <code>loose logical</code> (0/1 are also OK). Simply add the sub-type in the type string (e.g. <code>"integer scalar"</code>), or if you allow multiple types, put them in parentheses rigth after the main class: e.g. <code>"scalar(character, integer)"</code>. See Section XI) in the examples. See also the section below for more information on the sub-types. Some types (<code>character</code>, <code>integer</code>, <code>numeric</code>, <code>logical</code> and <code>factor</code>) also support the keyword <code>"conv"</code> in <code>check_set_arg</code>.</p></li>
<li><p><code>GE</code>/<code>GT</code>/<code>LE</code>/<code>LT</code>: For atomic types with numeric data, you can check the values in the object. The GE/GT/LE/LT mean respectively greater or equal/greater than/lower or equal/lower than. The syntax is <code>GE{expr}</code>, with expr any expression. See Section IV) in the examples.</p></li>
<li><p><code>len(a, b)</code>: You can restrict the length of objects with <code>len(a, b)</code> (with <code>a</code> and <code>b</code> integers). Available for <code>vector</code> and <code>list</code>. Then the length must be in between <code>a</code> and <code>b</code>. Either <code>a</code> or <code>b</code> can be missing which means absence of restriction. If <code>len(a)</code>, this means must be equal to <code>a</code>. You can also use the keywords len(data) which ensures that the length is the same as the length of the object given in the argument <code>.data</code>, or <code>len(value)</code> which ensures the length is equal to the value given in <code>.value</code>. See Section IV) in the examples.</p></li>
<li><p><code>nrow(a, b)</code>, <code>ncol(a, b)</code>: To restrict the number of rows and columns. Available for <code>matrix</code>, <code>vmatrix</code>, <code>data.frame</code>, <code>vdata.frame</code>. Tolerates the <code>data</code> and <code>value</code> keywords (see in <code>len</code>). See Section IV) in the examples.</p></li>
<li><p>var(data, env): Available only for <code>formula</code>. <code>var(data)</code> ensures that the variables in the formula are present in the data set given by the extra argument <code>.data</code>. <code>var(env)</code> ensures they are present in the environment, and <code>var(data, env)</code> in either the environment or the data set. See Section VIII) in the examples.</p></li>
<li><p><code>arg(a, b)</code>: Available only for <code>function</code>. Ensures that the function has a number of arguments between <code>a</code> and <code>b</code>, both integers (possibly missing). Tolerates the <code>value</code> keyword (see in <code>len</code>). See Section V) in the examples.</p></li>
<li><p><code>left(a, b)</code> and <code>right(a, b)</code>: Only available for <code>formula</code>. Restricts the number of parts in the left-hand-side or in the right-hand-side of the formula. Tolerates the <code>value</code> keyword (see in <code>len</code>). See Section VIII) in the examples.</p></li>
</ul><p>[Section I)]: R:Section%20I)
[Section IV)]: R:Section%20IV)
[Section IV)]: R:Section%20IV)
[Section IV)]: R:Section%20IV)
[Section VI)]: R:Section%20VI)
[Section VI)]: R:Section%20VI)
[Section V)]: R:Section%20V)
[Section VIII)]: R:Section%20VIII)
[Section V)]: R:Section%20V)
[Section III)]: R:Section%20III)
[Section III)]: R:Section%20III)
[Section VI)]: R:Section%20VI)
[Section VI)]: R:Section%20VI)</p>
    </div>
    <div id="global-keywords">
    <h2>Global keywords</h2>
    


<p>There are eight global keywords that can be placed anywhere in the type. They are described in Section II) in the examples.</p><ul><li><p><code>NULL</code>: allows the argument to be equal to <code>NULL</code>.</p></li>
<li><p><code>safe NULL</code>: allows the argument to be equal to <code>NULL</code>, but an error is thrown if the argument is of the type <code>base$variable</code> or <code>base[["variable"]]</code>. This is to prevent oversights from the user, especially useful when the main class is a vector.</p></li>
<li><p><code>NULL{expr}</code>: allows the argument to be equal to <code>NULL</code>, if the argument is <code>NULL</code>, then it assigns the value of expr to the argument.</p></li>
<li><p><code>MBT</code>: (means "must be there") an error is thrown if the argument is not provided by the user.</p></li>
<li><p><code>eval</code>: used in combination with the extra argument <code>.data</code>. Evaluates the value of the argument both in the data set and in the environment (this means the argument can be a variable name).</p></li>
<li><p><code>evalset</code>: like <code>eval</code>, but after evaluation, assigns the obtained value to the argument. Only available in <code>check_set_arg</code>.</p></li>
<li><p><code>dotnames</code>: only when checking <code>'...'</code> argument (see the related section below). Enforces that each object in <code>'...'</code> has a name.</p></li>
</ul></div>
    <div id="the-match-and-charin-types">
    <h2>The <code>match</code> and <code>charin</code> types</h2>
    


<p>The main classes <code>match</code> and <code>charin</code> are similar to <code><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></code>. These two types are detailed in the examples Section III).</p>
<p>By default, the main class <code>match</code> expects a single character string whose value is in a set of choices. By default, there is no case sensitity (which can be turned on with the option <code>strict</code>) and there is always partial matching. It can expect a vector (instead of a single element) if the option <code>multi</code> is present.</p>
<p>You have three different ways to set the choices:</p><ul><li><p>by setting the argument default: e.g. <code>fun = function(x = c("Tom", "John")) check_arg(x, "match")</code></p></li>
<li><p>by providing the argument <code>.choices</code>: e.g. <code>fun = function(x) check_arg(x, "match", .choices = c("Tom", "John"))</code></p></li>
<li><p>by writing the choices in parentheses: e.g. <code>fun = function(x) check_arg(x, "match(Tom, John)")</code></p></li>
</ul><p>When the user doesn't provide the argument, the default is set to the first choice.
Since the main class <code>match</code> performs a re-assignment of the variable, it is only available in <code>check_set_arg</code>.</p>
<p>The main class <code>charin</code> is similar to <code>match</code> in that it expects a single character string in a set of choices. The main differences are: i) there is no partial matching, ii) the choices cannot be set by setting the argument default, and iii) its checking can be turned off with setDreamer_check(FALSE) (that's the main difference between <code>check_arg</code> and <code>check_set_arg</code>).</p>
    </div>
    <div id="combining-multiple-types">
    <h2>Combining multiple types</h2>
    


<p>You can combine multiple types with a pipe: '|'. The syntax is as follows:</p>
<p><code>"main_type option(x) restriction(s) | main_type option(x) restriction(s) | main_type option(x) restriction(s)"</code></p>
<p>You can combine as many types as you want. The behavior is as follows: if the argument matches any of the types, then that's fine.</p>
<p>For example, say you require an argument to be either a logical scalar, either a data.frame, then you can write: <code>check_arg(x, "logical scalar | data.frame")</code>. See Section X) in the examples for a more complex example.</p>
    </div>
    <div id="tips-on-the-type">
    <h2>Tips on the type</h2>
    


<p>The type MUST be a character string of length 1. Two main classes must be separated by a pipe. Otherwise the order of the keywords, the spaces, or the case don't matter. Further the global keywords can be placed anywhere and need not be separated by a pipe.</p>
<p>Note that a rare but problematic situation is when you set a default with the global <code>NULL{default}</code> and that default contains a keyword. For example in the type <code>"NULL{list()} numeric matrix"</code> <code>list</code> should not be considered as a main class, but only <code>matrix</code>. To be on the safe side, then just separate them with a pipe: <code>"NULL{list()} | numeric matrix"</code> would work appropriately.</p>
    </div>
    <div id="checking-multiple-arguments">
    <h2>Checking multiple arguments</h2>
    


<p>You can check multiple arguments at once provided they are of the same type. Say variables <code>x1</code> to <code>x5</code> should be logical scalars. Just use: <code>check_arg(x1, x2, x3, x4, x5, "logical scalar")</code>. It is always more efficient to check multiple arguments of the same type <em>at once</em>.</p>
<p>It is important to note that in case of multiple arguments, you can place the type anywhere you want provided it is a character literal (and not in a variable!). This means that <code>check_arg("logical scalar", x1, x2, x3, x4, x5)</code> would also work.</p>
<p>If your type is in a variable, then you must explicitly provide the argument <code>.type</code> (like in <code>check_arg(x, .type = my_type)</code>).</p>
    </div>
    <div id="nesting-argument-checking-up-">
    <h2>Nesting argument checking (<code>.up</code>)</h2>
    


<p>When you develop several functions that share common features, it is usually good practice to pool the common computations into an internal function (to avoid code duplication).</p>
<p>When you do so, you can do all the argument checking in the internal function. Then use the argument <code>.up = 1</code> so that if the user provdes a wrong argument, the error message will refer to the user-level function and NOT to the internal function, making it much clearer for the user.</p>
<p>This is detailed in Section XII) in the examples.</p>
    </div>
    <div id="checking-the-dot-dot-dot-argument">
    <h2>Checking the <code>...</code> (dot-dot-dot) argument</h2>
    


<p><code>check_arg</code> offers the possibility to check the <code>...</code>, provided each expected object in <code>...</code> should be of the same type. To do that, just add <code>...</code> as the first argument in <code>check_arg</code>, that's it! For example, you want all elements of <code>...</code> to be numeric vectors, then use <code>check_arg(..., "numeric vector")</code>.</p>
<p>When checking <code>...</code>, you have the special global argument <code>dotnames</code> which enforces that each element in <code>...</code> has a name. Further, the other global <code>MBT</code> (must be there) now means that at least one element in <code>...</code> must be provided.</p>
<p>This is detailed in Section XIV) in the examples.</p>
    </div>
    <div id="what-s-the-difference-between-check-arg-and-check-set-arg-">
    <h2>What's the difference between <code>check_arg</code> and <code>check_set_arg</code>?</h2>
    


<p>The function <code>check_set_arg</code> extends <code>check_arg</code> in several ways. First it offers new keywords:</p><ul><li><p><code>evalset</code>: evaluates the argument in a data set (i.e. the argument can be variables names of a data set), then re-assigns back its value.</p></li>
<li><p><code>NULL{default}</code>: if the argument is <code>NULL</code>, then the value in curly brackets is assigned to the argument.</p></li>
<li><p><code>match</code>: if the argument partially matches the choices, then the matches are assigned to the argument.</p></li>
<li><p><code>conv</code>: in atomic main classes (<code>scalar</code>, <code>vector</code> and <code>matrix</code>), the data can be converted to a given sub-type (currently <code>integer</code>, <code>numeric</code>, <code>logical</code>, <code>character</code> and <code>factor</code>), then assigned back to the argument.</p></li>
</ul><p>As you can see, it's all about assignment: these special keywords of <code>check_set_arg</code> will modify the arguments <em>in place</em>. You have such examples in Section II), III) and XI) of the examples.</p>
<p>Second, it allows to check arguments that are themselves list of arguments (note that <code>conv</code> also works in that case). For example, one argument of your function is <code>plot.opts</code>, a list of arguments to be passed to plot. You can check the elements of <code>plot.opts</code> (e.g. <code>plot.opts$main</code>) with <code>check_set_arg</code>. It also re-assigns the values of the list given the special keywords just described. List element checking is described in Section XIII) of the examples.</p>
<p>Then why creating two functions? If the user runs a function in which the arguments were checked with <code>check_arg</code> and it works, then argument checking can be safely disabled, and it would also work. On the other hand, since <code>check_set_arg</code> does value re-assignment, it cannot be safely turned-off--therefore cannot be disabled with <code><a href="setDreamerr_check.html">setDreamerr_check</a></code>. Distinguishing between the two allows the user to disable argument checking and gain (although very modest) perfomance in large loops. Therefore, when you create functions, I suggest to use always <code>check_arg</code>, unless you need the extra features of <code>check_set_arg</code>.</p>
    </div>
    <div id="check-value">
    <h2><code>check_value</code></h2>
    


<p>The functions <code>check_value</code> and <code>check_set_value</code> are almost identical to the respective functions <code>check_arg</code> and <code>check_set_arg</code>. The key differences are as follows:</p>
<ul><li><p>They can check values instead of arguments. Indeed, if you try to check a value with <code>check_arg</code>, nothing will happen (provided the name of the value is not an argument). Why? Because it will consider it as a missing argument. Therefore, you are can check anything with <code>check_value</code>.</p></li>
<li><p>You can check only one item at a time (whereas you can check up to 10 arguments in <code>check_arg</code>).</p></li>
</ul><p>The main reason for using <code>check_value</code> is that sometimes you only know if an argument is valid after having perfomed some modifications on it. For instance, the argument may be a formula, but you also require that the variables in the formula are numeric. You cannot check all that at once with <code>check_arg</code>, but you can first check the formula with it, then extract the values from the formula and use <code>check_value</code> to ensure that the variables from the formula are numeric.</p>
<p><code>check_value</code> is detailed in Section XVI) in the examples.</p>
    </div>
    <div id="disabling-argument-checking">
    <h2>Disabling argument checking</h2>
    


<p>Although the argument checking offered by <code>check_arg</code> is highly optimized and fast (it depends on the type (and your computer), but it is roughly of the order of 80 micro seconds for non-missing arguments, 20 micro seconds for missing arguments), you may want to disable it for small functions in large loops (&gt;100K iterations although this practice is not really common in R). If so, just use the function <code><a href="setDreamerr_check.html">setDreamerr_check</a></code>, by typing <code>setDreamerr_check(FALSE)</code>. This will disable any call to <code>check_arg</code>.</p>
<p>Note that the argument checking of <code>check_set_arg</code> cannot be disabled because the special types it allows perform reassignment in the upper frame. That's the main difference with <code>check_arg</code>.</p>
    </div>
    <div id="the-developer-mode">
    <h2>The developer mode</h2>
    


<p>If you're new to check_arg, given the many types available, it's very common to make mistakes when creating check_arg calls. But no worry, the developer mode is here to help!</p>
<p>The developer mode ensures that any problematic call is spotted and the problem is clearly stated. It also refers to the related section in the examples if appropriate. To turn the developer mode on, use <code>setDreamerr_dev.mode(TRUE)</code>.</p>
<p>Note that since this mode ensures a detailed cheking of the call it is thus a strain on performance and should be always turned off otherwise needed. See Section XV) in the examples.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Laurent Berge</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check_arg is only used within functions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># I) Example for the main class "scalar"</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_scalar</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xlog</span>, <span class="va">xnum</span>, <span class="va">xint</span>, <span class="va">xnumlt</span>, <span class="va">xdate</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># when forming the type: you can see that case, order and spaces don't matter</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xlog</span>, <span class="st">"scalarLogical"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xnum</span>, <span class="st">"numeric scalar"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xint</span>, <span class="st">"  scalar Integer GE{0}  "</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xnumlt</span>, <span class="st">"numeric scalar lt{0.15}"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Below it is critical that there's no space between scalar and the parenthesis</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xdate</span>, <span class="st">"scalar(Date)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Following is OK</span></span></span>
<span class="r-in"><span><span class="fu">test_scalar</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">test_scalar</span><span class="op">(</span>xlog <span class="op">=</span> <span class="cn">FALSE</span>, xnum <span class="op">=</span> <span class="fl">55</span>, xint <span class="op">=</span> <span class="fl">5</span>, xnumlt <span class="op">=</span> <span class="fl">0.11</span>, xdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Now errors, all the following are wrong arguments, leading to errors</span></span></span>
<span class="r-in"><span><span class="co"># Please note the details in the error messages.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># logical</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xlog <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xlog = NA):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xlog` must be a logical scalar without NA.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is equal to NA while it should be NA-free.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xlog <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xlog = 2):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xlog` must be a logical scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of type logical (instead it is of type 'numeric').</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xlog <span class="op">=</span> <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xlog = sum):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xlog` must be a logical scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a scalar, it's a function.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xlog <span class="op">=</span> <span class="va">faefeaf5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xlog = faefeaf5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument 'xlog' (equal to 'faefeaf5') could not be evaluated.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: object 'faefeaf5' not found.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xlog = c(TRUE, FALSE)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xlog` must be a logical scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of length 1 (currently: 2).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xlog = c()):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xlog` must be a logical scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of length 1 (currently: 0).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># numeric</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xnum <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xnum = NA):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnum` must be a numeric scalar without NA.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is equal to NA while it should be NA-free.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xnum <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xnum = 1:5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnum` must be a numeric scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of length 1 (currently: 5).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xnum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xnum = Sys.Date()):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnum` must be a numeric scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not numeric (instead it is of type 'Date').</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># integer</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xint <span class="op">=</span> <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xint = 5.5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xint` must be an integer scalar with positive values.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not an integer, although it is numeric.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xint <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xint = -1):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xint` must be an integer scalar with positive values.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is strictly lower than 0 (-1).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># num &lt; 0.15</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xnumlt <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xnumlt = 0.15):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnumlt` must be a numeric scalar strictly lower than 0.15.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is equal to 0.15000 (while it should be *striclty* lower than</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> it).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xnumlt <span class="op">=</span> <span class="fl">0.16</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xnumlt = 0.16):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnumlt` must be a numeric scalar strictly lower than 0.15.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is greater than 0.15000 (0.16).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xnumlt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xnumlt = Sys.Date()):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnumlt` must be a numeric scalar strictly lower than 0.15.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not numeric (instead it is of type 'Date').</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Date</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_scalar</span><span class="op">(</span>xdate <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_scalar(xdate = 0.15):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xdate` must be a scalar of type 'Date'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of the appropriate type (instead it is of type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'numeric').</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># II) Examples for the globals: NULL, MBT, eval, evalset</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_globals</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xnum</span>, <span class="va">xlog</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">xint</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Default setting with NULL is only available in check_set_arg</span></span></span>
<span class="r-in"><span>  <span class="co"># MBT (must be there) throws an error if the user doesn't provide the argument</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">xnum</span>, <span class="st">"numeric vector NULL{1} MBT"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># NULL allows NULL values</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xlog</span>, <span class="st">"logical scalar safe NULL"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xint</span>, <span class="st">"integer vector"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xnum <span class="op">=</span> <span class="va">xnum</span>, xlog <span class="op">=</span> <span class="va">xlog</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># xnum is required because of MBT option</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_globals</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_globals():</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument 'xnum' is required.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is missing.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># NULL{expr} sets the value of xnum to expr if xnum = NULL</span></span></span>
<span class="r-in"><span><span class="co"># Here NULL{1} sets xnum to 1</span></span></span>
<span class="r-in"><span><span class="fu">test_globals</span><span class="op">(</span>xnum <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $xnum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $xlog</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># NULL (not NULL{expr}) does not reassign: xlog remains NULL</span></span></span>
<span class="r-in"><span><span class="fu">test_globals</span><span class="op">(</span>xnum <span class="op">=</span> <span class="cn">NULL</span>, xlog <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $xnum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $xlog</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># safe NULL: doesn't accept NULL from data.frame (DF) subselection</span></span></span>
<span class="r-in"><span><span class="co"># ex: the variable 'log' does not exist in the iris DF</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_globals</span><span class="op">(</span><span class="fl">5</span>, xlog <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">log</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_globals(5, xlog = iris$log):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  The (nullable) argument `xlog` must be a logical scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is NULL (fine) but you entered 'iris$log'. If you really want it</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to be NULL, please use NULL directly or a variable containing NULL.</span>
<span class="r-in"><span><span class="co"># but xnum accepts it</span></span></span>
<span class="r-in"><span><span class="fu">test_globals</span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">log</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $xnum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $xlog</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># eval and evalset</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_eval</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x1</span>, <span class="st">"eval numeric vector"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># evalset is in check_set_arg</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">x2</span>, <span class="st">"evalset numeric vector"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co"># We show the variables</span></span></span>
<span class="r-in"><span> <span class="kw">if</span><span class="op">(</span><span class="fl">1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">i</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"x1:\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">x1</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="kw">if</span><span class="op">(</span><span class="fl">2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">i</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"x2:\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="va">x2</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># eval: evaluates the argument both in the environment and the data</span></span></span>
<span class="r-in"><span><span class="fu">test_eval</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">Sepal.Length</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="co"># OK</span></span></span>
<span class="r-in"><span><span class="co"># if we use a variable not in the environment nor in the data =&gt; error</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_eval</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">Sopal.Length</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_eval(x1 = Sopal.Length, data = iri...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument 'x1' (equal to 'Sopal.Length') could not be evaluated.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: The variable 'Sopal.Length' is not in the data set (given in</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> argument 'data') nor in the environment.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># but eval doesn't reassign back the value of the argument:</span></span></span>
<span class="r-in"><span><span class="fu">test_eval</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">Sepal.Length</span>, data <span class="op">=</span> <span class="va">iris</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Error in eval(expr, envir, enclos) : object 'Sepal.Length' not found\n"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># evaset does the same as eval, but also reasssigns the value obtained:</span></span></span>
<span class="r-in"><span><span class="fu">test_eval</span><span class="op">(</span>x2 <span class="op">=</span> <span class="va">Sepal.Length</span>, data <span class="op">=</span> <span class="va">iris</span>, i <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1] "5.1" "4.9" "4.7" "4.6" "5"   "5.4" "4.6" "5"   "4.4" "4.9" "5.4" "4.8"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [13] "4.8" "4.3" "5.8" "5.7" "5.4" "5.1" "5.7" "5.1" "5.4" "5.1" "4.6" "5.1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [25] "4.8" "5"   "5"   "5.2" "5.2" "4.7" "4.8" "5.4" "5.2" "5.5" "4.9" "5"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [37] "5.5" "4.9" "4.4" "5.1" "5"   "4.5" "4.4" "5"   "5.1" "4.8" "5.1" "4.6"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [49] "5.3" "5"   "7"   "6.4" "6.9" "5.5" "6.5" "5.7" "6.3" "4.9" "6.6" "5.2"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [61] "5"   "5.9" "6"   "6.1" "5.6" "6.7" "5.6" "5.8" "6.2" "5.6" "5.9" "6.1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [73] "6.3" "6.1" "6.4" "6.6" "6.8" "6.7" "6"   "5.7" "5.5" "5.5" "5.8" "6"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [85] "5.4" "6"   "6.7" "6.3" "5.6" "5.5" "5.5" "6.1" "5.8" "5"   "5.6" "5.7"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [97] "5.7" "6.2" "5.1" "5.7" "6.3" "5.8" "7.1" "6.3" "6.5" "7.6" "4.9" "7.3"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [109] "6.7" "7.2" "6.5" "6.4" "6.8" "5.7" "5.8" "6.4" "6.5" "7.7" "7.7" "6"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [121] "6.9" "5.6" "7.7" "6.3" "6.7" "7.2" "6.2" "6.1" "6.4" "7.2" "7.4" "7.9"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [133] "6.4" "6.3" "6.1" "7.7" "6.3" "6.4" "6"   "6.9" "6.7" "6.9" "5.8" "6.8"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [145] "6.7" "6.7" "6.3" "6.5" "6.2" "5.9"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># III) Match and charin</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># match  =&gt; does partial matching, only available in check_set_arg</span></span></span>
<span class="r-in"><span><span class="co"># charin =&gt; no partial matching, exact values required, but in check_arg</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># match</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note the three different ways to provide the choices</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># If the argument has no default, it is kept that way (see x2)</span></span></span>
<span class="r-in"><span><span class="co"># If the argument is not provided by the user,</span></span></span>
<span class="r-in"><span><span class="co">#  it is left untouched (see x3)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_match</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bonjour"</span>, <span class="st">"Au revoir"</span><span class="op">)</span>, <span class="va">x2</span>, <span class="va">x3</span> <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># 1) choices set thanks to the argument default (like in match.arg)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">x1</span>, <span class="st">"strict match"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 2) choices set with the argument .choices</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">x2</span>, <span class="st">"match"</span>, .choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sarah"</span>, <span class="st">"Santa"</span>, <span class="st">"Santa Fe"</span>, <span class="st">"SANTA"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 3) choices set with the parentheses</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">x3</span>, <span class="st">"multi match(Orange, Juice, Good)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"x1:"</span>, <span class="va">x1</span>, <span class="st">"\nx2:"</span>, <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="va">x2</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="st">"[missing]"</span><span class="op">)</span>, <span class="st">"\nx3:"</span>, <span class="va">x3</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Everything below is OK</span></span></span>
<span class="r-in"><span><span class="fu">test_match</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1: bonjour </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2: [missing] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3: test </span>
<span class="r-in"><span><span class="fu">test_match</span><span class="op">(</span>x1 <span class="op">=</span> <span class="st">"Au"</span>, x2 <span class="op">=</span> <span class="st">"sar"</span>, x3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOOD"</span>, <span class="st">"or"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1: Au revoir </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2: Sarah </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3: Good Orange </span>
<span class="r-in"><span><span class="fu">test_match</span><span class="op">(</span>x2 <span class="op">=</span> <span class="st">"Santa"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1: bonjour </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2: Santa </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3: test </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Errors caught:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Au"</span>, <span class="st">"revoir"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x1 = c("Au", "revoir")):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x1` must be a single character equal to 'bonjour' or 'Au revoir'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (case sensitive).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of length 1 (currently: 2).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x1 <span class="op">=</span> <span class="st">"au"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x1 = "au"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x1` must be a single character equal to 'bonjour' or 'Au revoir'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (case sensitive).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: no match was found for 'au' (note that it is case sensitive, maybe</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> you meant 'Au revoir'?).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">sum</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x1 = sum):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x1` must be a single character equal to 'bonjour' or 'Au revoir'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (case sensitive).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a vector, it's a function.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x1 = list(a = 1:5)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x1` must be a single character equal to 'bonjour' or 'Au revoir'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (case sensitive).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a vector, it's a list.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x2 <span class="op">=</span> <span class="st">"san"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x2 = "san"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x2` must be a single character equal to 'Sarah', 'Santa', 'Santa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Fe' or 'SANTA'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: more than one value was matched for 'san': 'Santa', 'Santa Fe' and</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'SANTA'.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x2 <span class="op">=</span> <span class="st">"santa"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x2 = "santa"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x2` must be a single character equal to 'Sarah', 'Santa', 'Santa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Fe' or 'SANTA'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: more than one value was matched for 'santa': 'Santa' and 'SANTA',</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> please check the case.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same value as x3's default, but now provided by the user</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x3 <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x3 = "test"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x3` must be a character vector with values equal to 'Orange',</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  'Juice' or 'Good'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: no match was found for 'test'.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_match</span><span class="op">(</span>x3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"or"</span>, <span class="st">"ju"</span>, <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_match(x3 = c("or", "ju", "bad")):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x3` must be a character vector with values equal to 'Orange',</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  'Juice' or 'Good'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: no match was found for 'bad' [third element].</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can check multiple arguments at once</span></span></span>
<span class="r-in"><span><span class="co"># [see details for multiple arguments in Section X)]</span></span></span>
<span class="r-in"><span><span class="co"># Note that now the choices must be set in the argument</span></span></span>
<span class="r-in"><span><span class="co">#  and they must have the same options (ie multi, strict)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_match_multi</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bonjour"</span>, <span class="st">"Au revoir"</span><span class="op">)</span>, <span class="va">x2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sarah"</span>, <span class="st">"Santa"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            <span class="va">x3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Orange"</span>, <span class="st">"Juice"</span>, <span class="st">"Good"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># multiple arguments at once</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span>, <span class="st">"match"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"x1:"</span>, <span class="va">x1</span>, <span class="st">"\nx2:"</span>, <span class="va">x2</span>, <span class="st">"\nx3:"</span>, <span class="va">x3</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">test_match_multi</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1: bonjour </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2: Sarah </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3: Orange </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># charin</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># charin is similar to match but requires the user to provide the exact value</span></span></span>
<span class="r-in"><span><span class="co"># only the multi option is available</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_charin</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span> <span class="op">=</span> <span class="st">"bonjour"</span>, <span class="va">x2</span>  <span class="op">=</span> <span class="st">"Sarah"</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 1) set the choices with .choices</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x1</span>, <span class="st">"charin"</span>, .choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bonjour"</span>, <span class="st">"au revoir"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># 2) set the choices with the parentheses</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x2</span>, <span class="st">"multi charin(Sarah, Santa, Santa Fe)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"x1:"</span>, <span class="va">x1</span>, <span class="st">"\nx2:"</span>, <span class="va">x2</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now we need the exact values</span></span></span>
<span class="r-in"><span><span class="fu">test_charin</span><span class="op">(</span><span class="st">"au revoir"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Santa"</span>, <span class="st">"Santa Fe"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1: au revoir </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2: Santa Santa Fe </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Errors when partial matching tried</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_charin</span><span class="op">(</span><span class="st">"au re"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_charin("au re"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x1` must be a single character equal to 'bonjour' or 'au revoir'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: the value 'au re' doesn't match any choice (note that no partial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matching is performed).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># IV) Vectors and marices, equalities, dimensions and lengths</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can restrict the length of objects with len(a, b)</span></span></span>
<span class="r-in"><span><span class="co">#    - if len(a, b) length must be in between a and b</span></span></span>
<span class="r-in"><span><span class="co">#    - if len(a, ) length must be at least a</span></span></span>
<span class="r-in"><span><span class="co">#    - if len(, b) length must be at most b</span></span></span>
<span class="r-in"><span><span class="co">#    - if len(a) length must be equal to a</span></span></span>
<span class="r-in"><span><span class="co"># You can also use the special keywords len(data) or len(value),</span></span></span>
<span class="r-in"><span><span class="co">#  but then the argument .data or .value must also be provided.</span></span></span>
<span class="r-in"><span><span class="co">#  (the related example comes later)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># You can restrict the number of rows/columns with nrow(a, b) and ncol(a, b)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># You can restrict a matrix to be square with the 'square' keyword</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># You can restrict the values an element can take with GE/GT/LE/LT,</span></span></span>
<span class="r-in"><span><span class="co"># respectively greater or equal/greater than/lower or equal/lower than</span></span></span>
<span class="r-in"><span><span class="co"># The syntax is GE{expr}, with expr any expression</span></span></span>
<span class="r-in"><span><span class="co"># Of course, it only works for numeric values</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># By default NAs are tolerated in vector, matrix and data.frame.</span></span></span>
<span class="r-in"><span><span class="co"># You can refuse NAs using the keyword: 'no na' or 'nona'</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_vmat</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xvec</span>, <span class="va">xmat</span>, <span class="va">xvmat</span>, <span class="va">xstmat</span>, <span class="va">xnamed</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># vector of integers with values between 5 and exp(3)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xvec</span>, <span class="st">"integer Vector GE{5} LT{exp(3)}"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># logical matrix with at least two rows and with 3 columns</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xmat</span>, <span class="st">"logicalMatrix NROW(2,) NCOL(3)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># vector or matrix (vmatrix) of integers or character strings</span></span></span>
<span class="r-in"><span>  <span class="co"># with at most 3 observations</span></span></span>
<span class="r-in"><span>  <span class="co"># NAs are not allowed</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xvmat</span>, <span class="st">"vmatrix(character, integer) nrow(,3) no na"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># square matrix of integers, logicals reports errors</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xstmat</span>, <span class="st">"strict integer square Matrix"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># A vector with names of length 2</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xnamed</span>, <span class="st">"named Vector len(2)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># OK</span></span></span>
<span class="r-in"><span><span class="fu">test_vmat</span><span class="op">(</span>xvec <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">20</span>, xmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, xvmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abc"</span>, <span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          xstmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, xnamed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>bon<span class="op">=</span><span class="fl">1</span>, jour<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Vector checks:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xvec <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xvec = 2):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xvec` must be an integer vector with values in between 5 and 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (strictly).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is strictly lower than 5 (2).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xvec <span class="op">=</span> <span class="fl">21</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xvec = 21):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xvec` must be an integer vector with values in between 5 and 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (strictly).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is greater than 20.086 (21).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xvec <span class="op">=</span> <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xvec = 5.5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xvec` must be an integer vector with values in between 5 and 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (strictly).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of type integer, although it is numeric.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Matrix checks:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xmat = matrix(TRUE, 3, 4)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xmat` must be a logical matrix with at least 2 rows and with 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 4 columns instead of 3.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xmat = matrix(2, 3, 3)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xmat` must be a logical matrix with at least 2 rows and with 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of type logical (instead it is of type 'numeric').</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xmat = matrix(FALSE, 1, 3)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xmat` must be a logical matrix with at least 2 rows and with 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 1 row while it should have at least 2 rows.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xmat <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xmat = iris):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xmat` must be a logical matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a matrix (instead it is a data.frame).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xvmat <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xvmat = iris):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xvmat` must be a matrix (or vector) of type 'character' or</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  'integer'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a matrix nor a vector (instead it is a data.frame).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xvmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xvmat = c(NA, 5)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xvmat` must be a matrix (or vector) of type 'character' or</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  'integer' without NAs with no more than 3 rows.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it contains 1 NA while it should be NA-free.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xstmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xstmat = matrix(1, 1, 3)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xstmat` must be a square integer matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a square matrix (1 row and 3 columns).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xstmat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xstmat = matrix(c(TRUE, FALSE...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xstmat` must be a square integer matrix.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not strictly of type integer, instead it is a logical.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Named vector checks:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xnamed <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xnamed = 1:3):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnamed` must be a named vector of length 2.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it does not have a name attribute.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_vmat</span><span class="op">(</span>xnamed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>bon<span class="op">=</span><span class="fl">1</span>, jour<span class="op">=</span><span class="fl">2</span>, les<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_vmat(xnamed = c(bon = 1, jour = 2,...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnamed` must be a named vector of length 2.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is of length 3 instead of 2.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Illustration of the keywords 'data', 'value'</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 'value'</span></span></span>
<span class="r-in"><span><span class="co"># Matrix multiplication X * Y * Z</span></span></span>
<span class="r-in"><span><span class="va">test_dynamic_restriction</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="st">"mbt numeric matrix"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">y</span>, <span class="st">"mbt numeric matrix nrow(value)"</span>, .value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">z</span>, <span class="st">"mbt numeric matrix nrow(value)"</span>, .value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># An alternative to the previous two lines:</span></span></span>
<span class="r-in"><span>  <span class="co"># check_arg(z, "mbt numeric matrix")</span></span></span>
<span class="r-in"><span>  <span class="co"># check_arg(y, "mbt numeric matrix nrow(value) ncol(value)",</span></span></span>
<span class="r-in"><span>  <span class="co">#           .value = list(nrow = ncol(x), ncol = nrow(z)))</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">y</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">z</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fl">5</span>,  <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">test_dynamic_restriction</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -14.68151 -15.81842</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -14.68151 -15.81842</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now error</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_dynamic_restriction</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">z</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_dynamic_restriction(x, matrix(5, 1...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `y` must be a numeric matrix with, in this context, 3 rows.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 1 row instead of 3.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 'data'</span></span></span>
<span class="r-in"><span><span class="co"># Computing maximum difference between two matrices</span></span></span>
<span class="r-in"><span><span class="va">test_dynamic_bis</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="st">"mbt numeric matrix"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># we require y to be of the same dimension as x</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">y</span>, <span class="st">"mbt numeric matrix nrow(data) ncol(data)"</span>, .data <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">test_dynamic_bis</span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now error</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_dynamic_bis</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_dynamic_bis(x, y):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `y` must be a numeric matrix with the same dimensions as argument</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  'x' (2 rows and 3 columns).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 3 rows instead of 2.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># V) Functions and lists</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can restrict the number of arguments of a</span></span></span>
<span class="r-in"><span><span class="co"># function with arg(a, b) [see Section IV) for details]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_funlist</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xfun</span>, <span class="va">xlist</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xfun</span>, <span class="st">"function arg(1,2)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xlist</span>, <span class="st">"list len(,3)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># OK</span></span></span>
<span class="r-in"><span><span class="fu">test_funlist</span><span class="op">(</span>xfun <span class="op">=</span> <span class="va">sum</span>, xlist <span class="op">=</span> <span class="va">iris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># function checks:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_funlist</span><span class="op">(</span>xfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_funlist(xfun = function(x, y, z) x...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xfun` must be a function with a number of arguments in between 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  and 2.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 3 arguments while it should have a maximum of 2 arguments.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># list checks:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_funlist</span><span class="op">(</span>xlist <span class="op">=</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_funlist(xlist = iris[1:4]):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xlist` must be a list of length not greater than 3.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is of length 4, while it should have a maximum length of 3.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_funlist</span><span class="op">(</span>xlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># VI) Data.frame and custom class</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_df</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xdf</span>, <span class="va">xvdf</span>, <span class="va">xcustom</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># data.frame with at least 100 observations</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xdf</span>, <span class="st">"data.frame nrow(100,)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># data.frame or vector (vdata.frame)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xvdf</span>, <span class="st">"vdata.frame"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Either: i) object of class glm or lm</span></span></span>
<span class="r-in"><span>  <span class="co"># ii) NA</span></span></span>
<span class="r-in"><span>  <span class="co"># iii) NULL</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xcustom</span>, <span class="st">"class(lm, glm)|NA|null"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># OK</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">~</span><span class="va">Species</span>, <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">test_df</span><span class="op">(</span>xdf <span class="op">=</span> <span class="va">iris</span>, xcustom <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">test_df</span><span class="op">(</span>xvdf <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">test_df</span><span class="op">(</span>xcustom <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># data.frame checks:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_df</span><span class="op">(</span>xdf <span class="op">=</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_df(xdf = iris[1:50, ]):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xdf` must be a data.frame with at least 100 rows.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 50 rows while it should have at least 100 rows.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_df</span><span class="op">(</span>xdf <span class="op">=</span> <span class="va">iris</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_df</span><span class="op">(</span>xdf <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_df(xdf = iris$Sepal.Length):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xdf` must be a data.frame.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a data.frame (instead it is a vector).</span>
<span class="r-in"><span><span class="co"># Note that the following works:</span></span></span>
<span class="r-in"><span><span class="fu">test_df</span><span class="op">(</span>xvdf <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom class checks:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_df</span><span class="op">(</span>xcustom <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_df(xcustom = iris):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  The (nullable) argument `xcustom` must be either: i) an object of class</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  'lm' or 'glm', or ii) equal to NA.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: i) the object is not of the appropriate class (instead it is of</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class data.frame), or ii) it is not of length 1 (currently: 5).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># VIII) Formulas</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The keyword is 'formula'</span></span></span>
<span class="r-in"><span><span class="co"># You can restrict the formula to be:</span></span></span>
<span class="r-in"><span><span class="co"># - one sided with 'os'</span></span></span>
<span class="r-in"><span><span class="co"># - two sided with 'ts'</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># You can restrict that the variables of a forumula must be in</span></span></span>
<span class="r-in"><span><span class="co"># a data set or in the environment with var(data, env)</span></span></span>
<span class="r-in"><span><span class="co"># - var(data) =&gt; variables must be in the data set</span></span></span>
<span class="r-in"><span><span class="co"># - var(env) =&gt; variables must be in the environment</span></span></span>
<span class="r-in"><span><span class="co"># - var(data, env) =&gt; variables must be in the data set or in the environment</span></span></span>
<span class="r-in"><span><span class="co"># Of course, if var(data), you must provide a data set</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Checking multipart formulas is included. You can use left(a, b)</span></span></span>
<span class="r-in"><span><span class="co">#  and right(a, b) to put restrictions in the number of parts allowed</span></span></span>
<span class="r-in"><span><span class="co">#  in the left and right-hand-sides</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_formulas</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fml1</span>, <span class="va">fml2</span>, <span class="va">fml3</span>, <span class="va">fml4</span>, <span class="va">data</span> <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Regular formula, variables must be in the data set</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">fml1</span>, <span class="st">"formula var(data)"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># One sided formula, variables in the environment</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">fml2</span>, <span class="st">"os formula var(env)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Two sided formula, variables in the data set or in the env.</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">fml3</span>, <span class="st">"ts formula var(data, env)"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># One or two sided, at most two parts in the RHS, at most 1 in the LHS</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">fml4</span>, <span class="st">"formula left(,1) right(,2)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We set x1 in the environment</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Works</span></span></span>
<span class="r-in"><span><span class="fu">test_formulas</span><span class="op">(</span><span class="op">~</span><span class="va">Sepal.Length</span>, <span class="op">~</span><span class="va">x1</span>, <span class="va">Sepal.Length</span><span class="op">~</span><span class="va">x1</span>, <span class="va">a</span> <span class="op">~</span> <span class="va">b</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now let's see errors</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_formulas</span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">~</span><span class="va">x1</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_formulas(Sepal.Length ~ x1, data = iris): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The argument 'fml1' is a formula whose variables must be in the data set</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> given in argument 'data'. Problem: the variable 'x1' is not in the data.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_formulas</span><span class="op">(</span>fml2 <span class="op">=</span> <span class="op">~</span><span class="va">Sepal.Length</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_formulas(fml2 = ~Sepal.Length, data = iris): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The argument 'fml2' is a formula whose variables must be in the environment.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Problem: the variable 'Sepal.Length' isn't there.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_formulas</span><span class="op">(</span>fml2 <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">~</span><span class="va">x1</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_formulas(fml2 = Sepal.Length ~ x1,...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `fml2` must be a one-sided formula.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is currently two-sided.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_formulas</span><span class="op">(</span>fml3 <span class="op">=</span> <span class="op">~</span><span class="va">x1</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_formulas(fml3 = ~x1, data = iris):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `fml3` must be a two-sided formula.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is currently only one-sided.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_formulas</span><span class="op">(</span>fml3 <span class="op">=</span> <span class="va">x1</span><span class="op">~</span><span class="va">x555</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_formulas(fml3 = x1 ~ x555, data = iris): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The argument 'fml3' is a formula whose variables must be in the data set</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (given in argument 'data') or in the environment. Problem: the variable</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'x555' isn't there.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_formulas</span><span class="op">(</span>fml4 <span class="op">=</span> <span class="va">a</span> <span class="op">~</span> <span class="va">b</span> <span class="op">|</span> <span class="va">c</span> <span class="op">|</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_formulas(fml4 = a ~ b | c | d):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `fml4` must be a formula with no more than 2 parts in the</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  right-hand-side and with no more than 1 part in the left-hand-side.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 3 parts in the right-hand-side while it should have a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> maximum of 2 parts.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_formulas</span><span class="op">(</span>fml4 <span class="op">=</span> <span class="va">a</span> <span class="op">|</span> <span class="va">b</span> <span class="op">~</span> <span class="va">c</span> <span class="op">|</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_formulas(fml4 = a | b ~ c | d):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `fml4` must be a formula with no more than 2 parts in the</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  right-hand-side and with no more than 1 part in the left-hand-side.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it has 2 parts in the left-hand-side while it should have a maximum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> of 1 part.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># IX) Multiple types</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can check multiple types using a pipe: '|'</span></span></span>
<span class="r-in"><span><span class="co"># Note that global keywords (like NULL, eval, etc) need not be</span></span></span>
<span class="r-in"><span><span class="co"># separated by pipes. They can be anywhere, the following are identical:</span></span></span>
<span class="r-in"><span><span class="co">#  - "character scalar | data.frame NULL"</span></span></span>
<span class="r-in"><span><span class="co">#  - "NULL character scalar | data.frame"</span></span></span>
<span class="r-in"><span><span class="co">#  - "character scalar NULL | data.frame"</span></span></span>
<span class="r-in"><span><span class="co">#  - "character scalar | data.frame | NULL"</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_mult</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># x must be either:</span></span></span>
<span class="r-in"><span>  <span class="co"># i) a numeric vector of length at least 2</span></span></span>
<span class="r-in"><span>  <span class="co"># ii) a square character matrix</span></span></span>
<span class="r-in"><span>  <span class="co"># iii) an integer scalar (vector of length 1)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="st">"numeric vector len(2,) | square character matrix | integer scalar"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># OK</span></span></span>
<span class="r-in"><span><span class="fu">test_mult</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">test_mult</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">test_mult</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="st">"ok"</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Not OK, notice the very detailed error messages</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_mult</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="st">"bonjour"</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_mult(matrix("bonjour", 1, 2)):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x` must be either: i) a numeric vector, ii) a square character</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  matrix, or iii) an integer scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is a matrix but it is not a square matrix (1 row and 2 columns).</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_mult</span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_mult(1.1):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x` must be either: i) a numeric vector of length at least equal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  to 2, ii) a square character matrix, or iii) an integer scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: i) it is of length 1, while it should be at least of length 2, ii)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> it is not a matrix (instead it is a vector), or iii) it is not an integer,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> although it is numeric.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># X) Multiple arguments</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can check multiple arguments at once if they have the same type.</span></span></span>
<span class="r-in"><span><span class="co"># You can add the type where you want but it must be a character literal.</span></span></span>
<span class="r-in"><span><span class="co"># You can check up to 10 arguments with the same type.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_multiarg</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xlog1</span>, <span class="va">xlog2</span>, <span class="va">xnum1</span>, <span class="va">xnum2</span>, <span class="va">xnum3</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># checking the logicals</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">xlog1</span>, <span class="va">xlog2</span>, <span class="st">"logical scalar"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># checking the numerics</span></span></span>
<span class="r-in"><span>  <span class="co"># =&gt; Alternatively, you can add the type first</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="st">"numeric vector"</span>, <span class="va">xnum1</span>, <span class="va">xnum2</span>, <span class="va">xnum3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's throw some errors</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_multiarg</span><span class="op">(</span>xlog2 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_multiarg(xlog2 = 4):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xlog2` must be a logical scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of type logical (instead it is of type 'numeric').</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_multiarg</span><span class="op">(</span>xnum3 <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_multiarg(xnum3 = "test"):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `xnum3` must be a numeric vector.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not numeric (instead it is of type 'character').</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># XI) Multiple sub-stypes</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For atomic arguments (like vector or matrices),</span></span></span>
<span class="r-in"><span><span class="co"># you can check the type of underlying data: is it integer, numeric, etc?</span></span></span>
<span class="r-in"><span><span class="co"># There are five simple sub-types:</span></span></span>
<span class="r-in"><span><span class="co"># - integer</span></span></span>
<span class="r-in"><span><span class="co"># - numeric</span></span></span>
<span class="r-in"><span><span class="co"># - factor</span></span></span>
<span class="r-in"><span><span class="co"># - logical</span></span></span>
<span class="r-in"><span><span class="co"># - loose logical: either TRUE/FALSE, either 0/1</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># If you require that the data is of one sub-type only:</span></span></span>
<span class="r-in"><span><span class="co"># - a) if it's one of the simple sub-types: add the keyword directly in the type</span></span></span>
<span class="r-in"><span><span class="co"># - b) otherwise: add the sub-type in parentheses</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Note that the parentheses MUST follow the main class directly.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Example:</span></span></span>
<span class="r-in"><span><span class="co"># - a) "integer scalar"</span></span></span>
<span class="r-in"><span><span class="co"># - b) "scalar(Date)"</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># If you want to check multiple sub-types: you must add them in parentheses.</span></span></span>
<span class="r-in"><span><span class="co"># Again, the parentheses MUST follow the main class directly.</span></span></span>
<span class="r-in"><span><span class="co"># Examples:</span></span></span>
<span class="r-in"><span><span class="co"># "vector(character, factor)"</span></span></span>
<span class="r-in"><span><span class="co"># "scalar(integer, logical)"</span></span></span>
<span class="r-in"><span><span class="co"># "matrix(Date, integer, logical)"</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># In check_set_arg, you can use the keyword "conv" to convert to the</span></span></span>
<span class="r-in"><span><span class="co"># desired type</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_multi_subtypes</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="st">"scalar(integer, logical)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">y</span>, <span class="st">"vector(character, factor, Date)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># What follows doesn't work</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_multi_subtypes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_multi_subtypes(x = 5.5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `x` must be a scalar of type 'integer' or 'logical'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of the appropriate type (instead it is of type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'numeric').</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note that it works if x = 5</span></span></span>
<span class="r-in"><span><span class="co">#  (for check_arg 5 is integer although is.integer(5) returns FALSE)</span></span></span>
<span class="r-in"><span><span class="fu">test_multi_subtypes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_multi_subtypes</span><span class="op">(</span>y <span class="op">=</span> <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in test_multi_subtypes(y = 5.5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `y` must be a vector of type 'character', 'factor' or 'Date'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of the appropriate type (instead it is of type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'numeric').</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Testing the "conv" keyword:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_conv</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">type</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">x</span>, .type <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu">test_conv</span><span class="op">(</span><span class="fl">5L</span>, <span class="st">"numeric scalar conv"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "numeric"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu">test_conv</span><span class="op">(</span><span class="fl">5</span>, <span class="st">"integer scalar conv"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "integer"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu">test_conv</span><span class="op">(</span><span class="fl">5</span>, <span class="st">"integer scalar"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "numeric"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can use the "conv" keyword in multi-types</span></span></span>
<span class="r-in"><span><span class="co"># Remember that types are checked in ORDER! (see the behavior)</span></span></span>
<span class="r-in"><span><span class="fu">test_conv</span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">1</span>, <span class="st">"vector(logical, character conv)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "5" "4" "3" "2" "1"</span>
<span class="r-in"><span><span class="fu">test_conv</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="st">"vector(logical, character conv)"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  TRUE FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># XII) Nested checking: using .up</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Say you have two user level functions</span></span></span>
<span class="r-in"><span><span class="co"># But you do all the computation in an internal function.</span></span></span>
<span class="r-in"><span><span class="co"># The error message should be at the level of the user-level function</span></span></span>
<span class="r-in"><span><span class="co"># You can use the argument .up to do that</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sum_fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">my_internal</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, sum <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">diff_fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">my_internal</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, sum <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">my_internal</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">sum</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># The error messages will be at the level of the user-level functions</span></span></span>
<span class="r-in"><span>  <span class="co"># which are 1 up the stack</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"numeric scalar mbt"</span>, .up <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span><span class="va">sum</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># we check it works</span></span></span>
<span class="r-in"><span><span class="fu">sum_fun</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 11</span>
<span class="r-in"><span><span class="fu">diff_fun</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's throw some errors</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">sum_fun</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in sum_fun(5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument 'y' is required.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is missing.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">diff_fun</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in diff_fun(5, 1:5):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Argument `y` must be a numeric scalar.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not of length 1 (currently: 5).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The errors are at the level of sum_fun/diff_fun although</span></span></span>
<span class="r-in"><span><span class="co"># the arguments have been checked in my_internal.</span></span></span>
<span class="r-in"><span><span class="co"># =&gt; much easier for the user to understand the problem</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># XIII) Using check_set_arg to check and set list defaults</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sometimes it is useful to have arguments that are themselves</span></span></span>
<span class="r-in"><span><span class="co"># list of arguments.</span></span></span>
<span class="r-in"><span><span class="co"># Witch check_set_arg you can check the arguments nested in lists</span></span></span>
<span class="r-in"><span><span class="co"># and easily set default values at the same time.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># When you check a list element, you MUST use the syntax argument$element</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Function that performs a regression then plots it</span></span></span>
<span class="r-in"><span><span class="va">plot_cor</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">lm.opts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">plot.opts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">line.opts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"numeric vector"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># First we ensure the arguments are lists</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">lm.opts</span>, <span class="va">plot.opts</span>, <span class="va">line.opts</span>, <span class="st">"named list"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The linear regression</span></span></span>
<span class="r-in"><span>  <span class="va">lm.opts</span><span class="op">$</span><span class="va">formula</span> <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span></span></span>
<span class="r-in"><span>  <span class="va">reg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"lm"</span>, <span class="va">lm.opts</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># plotting the correlation, with defaults</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">plot.opts</span><span class="op">$</span><span class="va">main</span>, <span class="st">"character scalar NULL{'Correlation between x and y'}"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># you can use variables created in the function when setting the default</span></span></span>
<span class="r-in"><span>  <span class="va">x_name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">plot.opts</span><span class="op">$</span><span class="va">xlab</span>, <span class="st">"character scalar NULL{x_name}"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">plot.opts</span><span class="op">$</span><span class="va">ylab</span>, <span class="st">"character scalar NULL{'y'}"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># we restrict to only two plotting types: p or h</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">plot.opts</span><span class="op">$</span><span class="va">type</span>, <span class="st">"NULL{'p'} match(p, h)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">plot.opts</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="va">x</span></span></span>
<span class="r-in"><span>  <span class="va">plot.opts</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="va">y</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"plot"</span>, <span class="va">plot.opts</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># with the fit</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">line.opts</span><span class="op">$</span><span class="va">col</span>, <span class="st">"NULL{'firebrick'}"</span><span class="op">)</span> <span class="co"># no checking but default setting</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_arg</span><span class="op">(</span><span class="va">line.opts</span><span class="op">$</span><span class="va">lwd</span>, <span class="st">"integer scalar GE{0} NULL{2}"</span><span class="op">)</span> <span class="co"># check + default</span></span></span>
<span class="r-in"><span>  <span class="va">line.opts</span><span class="op">$</span><span class="va">a</span> <span class="op">=</span> <span class="va">reg</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"abline"</span>, <span class="va">line.opts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sepal_length</span> <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span> ; <span class="va">y</span> <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Width</span></span></span>
<span class="r-in"><span><span class="fu">plot_cor</span><span class="op">(</span><span class="va">sepal_length</span>, <span class="va">y</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="check_arg-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">plot_cor</span><span class="op">(</span><span class="va">sepal_length</span>, <span class="va">y</span>, plot.opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, main <span class="op">=</span> <span class="st">"Another title"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="check_arg-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now throwing errors</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">plot_cor</span><span class="op">(</span><span class="va">sepal_length</span>, <span class="va">y</span>, plot.opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in plot_cor(sepal_length, y, plot.opts = l...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  In the list argument 'plot.opts', the (nullable) element 'type' must be a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  single character equal to 'p' or 'h'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: no match was found for 'l'.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">plot_cor</span><span class="op">(</span><span class="va">sepal_length</span>, <span class="va">y</span>, line.opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="op">-</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="check_arg-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in plot_cor(sepal_length, y, line.opts = l...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  In the list argument 'line.opts', the (nullable) element 'lwd' must be an</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  integer scalar with positive values.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is strictly lower than 0 (-50).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># XIV) Checking '...' (dot-dot-dot)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also check the '...' argument if you expect all objects</span></span></span>
<span class="r-in"><span><span class="co"># to be of the same type.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># To do so, you MUST place the ... in the first argument of check_arg</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sum_check</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># we want each element of ... to be numeric vectors without NAs</span></span></span>
<span class="r-in"><span>  <span class="co"># we want at least one element to be there (mbt)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">...</span>, <span class="st">"numeric vector mbt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># once the check is done, we apply sum</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">sum_check</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 215</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now let's compare the behavior of sum_check() with that of sum()</span></span></span>
<span class="r-in"><span><span class="co"># in the presence of errors</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span> ; <span class="va">y</span> <span class="op">=</span> <span class="va">pt</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">sum_check</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in sum_check(x, y):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  In argument '...', each element must be a numeric vector. Problem in the</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  second element: it is not a vector, it's a function.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in sum(x, y) : invalid 'type' (closure) of argument</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># As you can see, in the first call, it's very easy to spot and debug the problem</span></span></span>
<span class="r-in"><span><span class="co"># while in the second call it's almost impossible</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># XV) Developer mode</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you're new to check_arg, given the many types available,</span></span></span>
<span class="r-in"><span><span class="co"># it's very common to make mistakes when creating check_arg calls.</span></span></span>
<span class="r-in"><span><span class="co"># The developer mode ensures that any problematic call is spotted</span></span></span>
<span class="r-in"><span><span class="co"># and the problem is clearly stated</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Note that since this mode ensures a detailed cheking of the call</span></span></span>
<span class="r-in"><span><span class="co"># it is thus a strain on performance and should be always turned off</span></span></span>
<span class="r-in"><span><span class="co"># otherwise needed.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting the developer mode on:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="setDreamerr_dev.mode.html">setDreamerr_dev.mode</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Creating some 'wrong' calls =&gt; the problem is pinpointed</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_err1</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="st">"integer scalar"</span>, <span class="st">"numeric vector"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_err1</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in check_arg(x, "integer scalar", "numeric vector"): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Argument '.type' could not be identified: several character literals were</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> found. There is a very big problem in the call to check_arg which should</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> consist of only i) argument names and ii) the type. Please have a look at</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> the details/examples/vignette.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_err2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">check_arg</span><span class="op">(</span><span class="st">"numeric vector"</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_err2</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in check_arg("numeric vector", ...): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Problem in the arguments passed to check_arg(). If you want to check '...',</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> then '...' must be the first argument of check_arg (currently it is the</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> second).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_err3</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">a</span>, <span class="st">"numeric vector"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_err3</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in check_arg(x$a, "numeric vector"): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> You cannot check list elements in check_arg, but you can in check_set_arg.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Please refer to Section XIII) in the examples.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">test_err4</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">check_arg</span><span class="op">(</span><span class="va">x</span>, <span class="st">"numeric vector integer"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">test_err4</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in check_arg(x, "numeric vector integer"): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Problem in the type. In the main class 'vector' [fully equal to 'numeric</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> vector integer'], the following keyword(s) will not be used: 'numeric'.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Further, another sub-type was found in this remainder ('numeric'), this is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  not allowed. If you want to check several sub-types, please put them in</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  parentheses after the main class. See Section XI) in the examples.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting the developer mode off:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="setDreamerr_dev.mode.html">setDreamerr_dev.mode</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># XVI) Using check_value</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The main function for checking arguments is check_arg.</span></span></span>
<span class="r-in"><span><span class="co"># But sometimes you only know if an argument is valid after</span></span></span>
<span class="r-in"><span><span class="co">#  having perfomed some modifications on it.</span></span></span>
<span class="r-in"><span><span class="co"># =&gt; that's when check_value kicks in.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># It's better with an example.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># In this example we'll construct a plotting function</span></span></span>
<span class="r-in"><span><span class="co"># using a formula, with a rock-solid argument checking.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plotting function, but using a formula</span></span></span>
<span class="r-in"><span><span class="co"># You want to plot only numeric values</span></span></span>
<span class="r-in"><span><span class="va">plot_fml</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fml</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># We first check the arguments</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">data</span>, <span class="st">"data.frame mbt"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_arg</span><span class="op">(</span><span class="va">fml</span>, <span class="st">"ts formula mbt var(data)"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># We extract the values of the formula</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">=</span> <span class="va">fml</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">=</span> <span class="va">fml</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Now we check that x and y are valid =&gt; with check_value</span></span></span>
<span class="r-in"><span>  <span class="co"># We also use the possibility to assign the value of y and x directly</span></span></span>
<span class="r-in"><span>  <span class="co"># We add a custom message because y/x are NOT arguments</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_value</span><span class="op">(</span><span class="va">y</span>, <span class="st">"evalset numeric vector"</span>, .data <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>                   .message <span class="op">=</span> <span class="st">"In the argument 'fml', the LHS must be numeric."</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_value</span><span class="op">(</span><span class="va">x</span>, <span class="st">"evalset numeric vector"</span>, .data <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>                   .message <span class="op">=</span> <span class="st">"In the argument 'fml', the RHS must be numeric."</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The dots =&gt; only arguments to plot are valid</span></span></span>
<span class="r-in"><span>  <span class="va">args_ok</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">formalArgs</span><span class="op">(</span><span class="va">plot.default</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="validate_dots.html">validate_dots</a></span><span class="op">(</span>valid_args <span class="op">=</span> <span class="va">args_ok</span>, stop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># We also set the xlab/ylab</span></span></span>
<span class="r-in"><span>  <span class="va">dots</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="co"># dots has a special meaning in check_value (no need to pass .message)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_value</span><span class="op">(</span><span class="va">dots</span><span class="op">$</span><span class="va">ylab</span>, <span class="st">"NULL{deparse(fml[[2]])} character vector conv len(,3)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">check_set_value</span><span class="op">(</span><span class="va">dots</span><span class="op">$</span><span class="va">xlab</span>, <span class="st">"NULL{deparse(fml[[3]])} character vector conv len(,3)"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">dots</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="va">y</span></span></span>
<span class="r-in"><span>  <span class="va">dots</span><span class="op">$</span><span class="va">x</span> <span class="op">=</span> <span class="va">x</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"plot"</span>, <span class="va">dots</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's check it works</span></span></span>
<span class="r-in"><span><span class="fu">plot_fml</span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Sepal.Width</span>, <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="check_arg-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">plot_fml</span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Sepal.Width</span>, <span class="va">iris</span>, xlab <span class="op">=</span> <span class="st">"Not the default xlab"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="check_arg-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now let's throw some errors</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">plot_fml</span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span>, <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in plot_fml(Sepal.Length ~ Species, iris):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  In the argument 'fml', the RHS must be numeric.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not numeric (instead it is of type 'factor').</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">plot_fml</span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Petal.Length</span>, <span class="va">iris</span>, xlab <span class="op">=</span> <span class="va">iris</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in plot_fml(Sepal.Length ~ Petal.Length, i...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  In '...', if provided, the argument 'xlab' must be a character vector.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is not a vector, it's a data.frame.</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">plot_fml</span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Petal.Length</span>, <span class="va">iris</span>, xlab <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error : in plot_fml(Sepal.Length ~ Petal.Length, i...:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  In '...', if provided, the argument 'xlab' must be a character vector of</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  length not greater than 3.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PROBLEM: it is of length 150, while it should have a maximum length of 3.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

