<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>dreamerr: Error Handling Made Easy • dreamerr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="dreamerr: Error Handling Made Easy">
<meta property="og:description" content="dreamerr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dreamerr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dreamerr_introduction.html">dreamerr: Error Handling Made Easy</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrberge/dreamerr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>dreamerr: Error Handling Made Easy</h1>
                        <h4 data-toc-skip class="author">Laurent
Berge</h4>
            
            <h4 data-toc-skip class="date">2023-08-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/dreamerr/blob/HEAD/vignettes/dreamerr_introduction.Rmd" class="external-link"><code>vignettes/dreamerr_introduction.Rmd</code></a></small>
      <div class="hidden name"><code>dreamerr_introduction.Rmd</code></div>

    </div>

    
    
<p>This package aims to improve the user experience of R-users (just
that! :-)). It offers developers, or anyone writing functions (therefore
everyone!), a simple, flexible and powerful way to check all arguments
passed to a function.</p>
<p>Debugging a call to a function can be a very frustrating experience:
misleading and unclear error messages can make it quite long to finally
make the function work. But this needs not be the case. The
<code>dreamerr</code> package provides the <code>check_arg</code>
function that does all the work of checking the arguments for you. From
the developer side, it is easy and intuitive to perform a full check on
the arguments passed to the function: in one line of code. From the user
side, they will get, if they provide wrong arguments, useful and
informative error messages. In terms of perfomance, since the code has
been highly optimized, the cost of checking arguments with
<code>check_arg</code> is close to 0.</p>
<p>This short introduction gives some basics on how to use
<code>check_arg</code> after the following example.</p>
<div class="section level2">
<h2 id="motivating-example">Motivating example<a class="anchor" aria-label="anchor" href="#motivating-example"></a>
</h2>
<p>You have two numeric vectors x and y and you want to compute
<code>sum(x, y)</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in sum(x, y): invalid 'type' (closure) of argument</span></span></code></pre>
<p>Bam! there’s a problem… If you’re new to R, this message will look
quite puzzling–and very unlikely to be helpful. Even if you’re an
experienced R user (who’re acquainted to such error messages), it’s
impossible to understand from where the problem comes from.</p>
<p>Now you run the same function but with error-handling:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sum_check</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: in sum_check(x, y):</span></span>
<span><span class="co">##  In argument '...', each element must be a numeric vector. Problem in the</span></span>
<span><span class="co">##  second element: it is not a vector, it's a function.</span></span></code></pre>
<p>It’s still an error. But now anyone can clearly understand the
problem (even if you’re a R-beginner)! It tells us that what we thought
was a vector (<code>y</code>) was in fact a function. The time to debug
this error is 0s due to the clarity of the error message: we know which
argument is the culprit and we know exactly what the problem is.</p>
<p>There’s a big gap in terms of user experience between the two
functions, although there’s only one line of code of difference between
the two:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sum_check</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">...</span>, <span class="st">"numeric vector"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-to-use-check_arg">How to use <code>check_arg</code><a class="anchor" aria-label="anchor" href="#how-to-use-check_arg"></a>
</h2>
<p>The package offers (almost only) a single function:
<code>check_arg</code>. This function must be placed within a function,
its arguments must be argument names (the ones of the function),
followed by the type these arguments are expected to have. As follows:
<img src="../../../../../Google%20Drive/R_packages/dreamerr/dreamerr/articles/check_arg_call.png" alt="Figure 1: check_arg call"></p>
<p>Here are detailed only the basics. For much more detailed
information, with numerous examples, please see the help page of
<code>check_arg</code>.</p>
<div class="section level4">
<h4 id="argument--type">Argument <code>.type</code><a class="anchor" aria-label="anchor" href="#argument--type"></a>
</h4>
<p>The <code>.type</code> argument is the big thing. It supports
literally hundreds of different types and uses natural language to
express them. It must be a single character string, composed of several
types each separated by a pipe (<code>|</code>). For example if we use
<code>"logical scalar | ts formula | data.frame ncol(,2)"</code>, it
means that the argument must be either: a logical scalar
(i.e. <code>TRUE</code> or <code>FALSE</code>), ii) a two-sided formula,
or iii) a data.frame with maximum 2 columns. Each pipe separates a type,
each type is equal to one main class (here <code>scalar</code>,
<code>formula</code> and <code>data.frame</code>) with (optionally)
additional restrictions (here <code>logical</code>, <code>ts</code> and
<code>ncol(,2)</code>). The table below shows the 13 different class
codes and the restrictions they are associated to.</p>
<div class="float">
<img src="../../../../../Google%20Drive/R_packages/dreamerr/dreamerr/articles/forming_a_type.png" alt="Figure 2: Forming a type"><div class="figcaption">Figure 2: Forming a type</div>
</div>
<div class="section level5">
<h5 id="classes">Classes<a class="anchor" aria-label="anchor" href="#classes"></a>
</h5>
<p>The meaning of the classes is as follows:</p>
<ul>
<li><p><strong>scalar</strong>: an atomic vector of length 1, no
tolerance for NAs. Option <code>NA OK</code> allows NA values.</p></li>
<li><p><strong>vector</strong>: an atomic vector (vector of list do not
fall in this class), tolerance for NAs. Option <code>NO NA</code> throws
an error if it contains NAs, <code>named</code> requires the vector to
have names.</p></li>
<li><p><strong>matrix</strong>: a matrix, tolerance for NAs. Option
<code>NO NA</code> throws an error if it contains NAs,
<code>square</code> requires the matrix to be square.</p></li>
<li><p><strong>vmatrix</strong>: a matrix or vector, tolerance for NAs.
Option <code>NO NA</code> throws an error if it contains NAs,
<code>square</code> requires the matrix to be square (if a vector, then
it must be of length 1).</p></li>
<li><p><strong>data.frame</strong>: an object that inherits from
<code>data.frame</code>, tolerates NAs. Option <code>No NA</code> throws
an error if it contains NAs.</p></li>
<li><p><strong>vdata.frame</strong>: an object that inherits from
<code>data.frame</code>, or a vector; tolerates NAs. Option
<code>No NA</code> throws an error if it contains NAs.</p></li>
<li><p><strong>list</strong>: a list. Option <code>named</code> requires
it to have names.</p></li>
<li><p><strong>formula</strong>: a formula. Option <code>os</code>
(resp. <code>ts</code>) requires it to be one-sided (resp.
two-sided).</p></li>
<li><p><strong>function</strong>: a function.</p></li>
<li><p><strong>charin</strong>: a character scalar that must be in a
list of choices. Option <code>multi</code> accepts vectors of length
greater than 1. You can provide the choices in the argument
<code>.choices</code>, or directly in parentheses after the class:
<code>charin(value1, value2, etc)</code>.</p></li>
<li><p><strong>match</strong>: a character scalar that must be in a list
of choices after partial matching. Option <code>multi</code> accepts
vectors of length greater than 1, <code>strict</code> enables case
sensitivity (which is off by default). This class also reassigns the
argument after the partial matching. You have three ways to provide the
choices: i) in the argument <code>.choices</code>, ii) directly in
parentheses after the class: <code>match(value1, value2, etc)</code>, or
iii) in the argument’s default values,
e.g. <code>fun = function(x = c("value1", "value2", etc))</code>.</p></li>
<li><p><strong>path</strong>: a character scalar that should point to a
directory or a file. Option <code>dir</code> checks that the path points
to a directory. Option <code>read</code> checks that the file exists
already and has read permission. Option <code>create</code> creates up
to the grand-parent and parent folders in case these do not
exist.</p></li>
<li><p><strong>class</strong>: an object whose class is listed in
parentheses. Example: if <code>class(lm, glm)</code>, then only
<code>lm</code> or <code>glm</code> arguments will be accepted.</p></li>
<li><p><strong>NA</strong>: exactly <code>NA</code> (i.e. an atomic
vector of length 1 equal to NA).</p></li>
</ul>
</div>
<div class="section level5">
<h5 id="restrictions">Restrictions<a class="anchor" aria-label="anchor" href="#restrictions"></a>
</h5>
<p>Each of these classes supports a set of restrictions, explained in
Figure 2.</p>
<p>All atomic classes support sub-type restriction and restrictions
based on equality when the sub-type is numeric. The 5 simple sub-types
support conversion with the keyword <code>conv</code>, if this keyword
is present, then the value is converted to the appropriate type and
re-assigned back to the argument.</p>
<p>You can ensure the arguments have the appropriate length, number of
row or columns with <code>len(a, b)</code>, <code>nrow(a, b)</code> and
<code>ncol(a, b)</code>. Instead of having hard values, you can enforce
the arguments to have a length that depends on the context thanks to the
<code>len(data)</code> or <code>len(value)</code> syntax. For instance,
let’s say you have an argument <code>weights</code>, you want it to be a
vector whose length is equal to the number of observations in argument
<code>base</code>, then you can use
<code>check_arg(weights, "numeric vector len(data)", .data = base)</code>.
You could alternatively use
<code>check_arg(weights, "numeric vector len(value)", .value = NROW(base))</code>.</p>
<p>For formulas, there is a support for multi-part formulas (package <a href="https://cran.r-project.org/package=Formula" class="external-link">Formula</a>, Zeileis
and Croissant 2010), you can restrict the number of parts on the left or
right with the <code>left(a, b)</code> and <code>right(a, b)</code>
syntax. You can also ensure that all variables contained in the formula
are either in the data set provided in the argument <code>.data</code>
or in the environment with the <code>var(data, env)</code> syntax.</p>
<p>For functions, you can restrict the number of arguments they have
with <code>arg(a, b)</code>.</p>
</div>
<div class="section level5">
<h5 id="globals">Globals<a class="anchor" aria-label="anchor" href="#globals"></a>
</h5>
<p>On top of the types, you also have 8 global keywords that can be
anywhere in the type character string. These globals are:</p>
<ul>
<li><p><strong>MBT</strong>: requires the user to provide the argument
(Must Be There).</p></li>
<li><p><strong>NULL</strong>: allows the argument to be
<code>NULL</code>.</p></li>
<li><p><strong>NULL{expr}</strong>: allows the argument to be
<code>NULL</code>, if <code>NULL</code>, then the argument is
re-assigned the value of <code>expr</code>.</p></li>
<li><p><strong>safe NULL</strong>: allows the argument to be
<code>NULL</code> but forbids the argument to be of the type
<code>x$a</code> since <code>NULL</code> values in this case are often
mistakes–especially useful when the argument is a vector.</p></li>
<li><p><strong>L0</strong>: allows the argument to be of 0-length (by
default, there’s always an error for 0-length arguments).</p></li>
<li><p><strong>eval</strong>: evaluates the argument in a data set given
in the argument <code>.data</code>.</p></li>
<li><p><strong>evalset</strong>: evaluates the argument in a data set
given in the argument <code>.data</code>, then re-assigns the obtained
value to the argument.</p></li>
<li><p><strong>dotnames</strong>: when checking the <code>...</code>
argument, requires all elements to be named.</p></li>
</ul>
</div>
<div class="section level5">
<h5 id="check_set_arg">
<code>check_set_arg</code><a class="anchor" aria-label="anchor" href="#check_set_arg"></a>
</h5>
<p>Actually there are two functions to check arguments:
<code>check_arg</code> and <code>check_set_arg</code>. The difference
between the two is that i) the second allows keywords that re-assigns
values to the argument (i.e. the <code>match</code> class, the
<code>conv</code> keyword, <code>NULL{expr}</code>, and
<code>evalset</code>), and ii) allows to check list elements of list
arguments.</p>
<p>Let’s illustrate when to use <code>check_set_arg</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_cor</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">line.opts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># x: numeric vector, must be given by the user</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"numeric vector mbt"</span><span class="op">)</span></span>
<span>  <span class="co"># y: </span></span>
<span>  <span class="co">#  - numeric vector of the same length as x</span></span>
<span>  <span class="co"># - if y is NULL, then x with some noise is assigned to it </span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_set_arg</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"NULL{x + rnorm(length(x))} numeric vector len(data)"</span>, .data <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># We ensure line.opts is a list (even of 0-length)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">line.opts</span>, <span class="st">"named list L0"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># The linear regression + options from ...</span></span>
<span>  <span class="va">reg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># plotting the correlation</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># The fit, all arguments are in line.opts</span></span>
<span>  <span class="co"># col:</span></span>
<span>  <span class="co"># - if not provided =&gt; "firebrick"</span></span>
<span>  <span class="co"># - partially matched to firebrick or darkblue</span></span>
<span>  <span class="co"># - otherwise, a positive integer or a character scalar</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_set_arg</a></span><span class="op">(</span><span class="va">line.opts</span><span class="op">$</span><span class="va">col</span>, <span class="st">"NULL{'firebrick'} match(firebrick, darkblue) | scalar(integer, character) GE{0}"</span><span class="op">)</span> </span>
<span>  <span class="co"># lwd:</span></span>
<span>  <span class="co"># - if not provided =&gt; 2</span></span>
<span>  <span class="co"># - otherwise a positive integer scalar</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_set_arg</a></span><span class="op">(</span><span class="va">line.opts</span><span class="op">$</span><span class="va">lwd</span>, <span class="st">"integer scalar GE{0} NULL{2}"</span><span class="op">)</span> <span class="co"># check + default</span></span>
<span>  </span>
<span>  <span class="va">line.opts</span><span class="op">$</span><span class="va">a</span> <span class="op">=</span> <span class="va">reg</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"abline"</span>, <span class="va">line.opts</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_cor</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, line.opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"dark"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="dreamerr_introduction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Why sperating argument checking in two functions? First, it is
because <code>check_set_arg</code> requires (marginally, but still) more
processing–so it’s better to always use the faster function when
appropriate, and use <code>check_set_arg</code> only when needed.
Second, and this is the main reason, it is because <code>dreamerr</code>
allows the user to turn off argument checking with
<code>setDreamerr_check(FALSE)</code>. If a call to a function works,
then writting off all <code>check_arg</code> calls would also work. This
is not the case for <code>check_set_arg</code> since it re-assigns
values to the arguments–and therefore can’t be turned off.</p>
</div>
<div class="section level5">
<h5 id="developer-mode">Developer mode<a class="anchor" aria-label="anchor" href="#developer-mode"></a>
</h5>
<p>Ironically, to improve perfomance (since its computational footprint
should be very low), there is almost no error-handling in
<code>check_arg</code>!</p>
<p>But no worries: if you turn the developer mode on with
<code>setDreamerr_dev.mode(TRUE)</code>, an in-depth check of any call
to dreamerr’s functions will be performed. This is especially useful if
you are not familiar with the syntax.</p>
<p>Yet beware, this error checking is really in-depth, thus rather
computationnally intensive (about half a millisecond). Thus the
developer mode should be off the majority of the time.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="adding-error-handling-to-lm">Adding error-handling to <code>lm</code><a class="anchor" aria-label="anchor" href="#adding-error-handling-to-lm"></a>
</h2>
<p>Now that we know how to use <code>check_arg</code>, let’s provide
some error-handling to the <code>lm</code> function. There is still need
to check some stuff after that, but the bulk of the job is done (the
code is long because of the comments, otherwise it’s 9 lines for 13
arguments):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_check</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">subset</span>, <span class="va">weights</span>, <span class="va">na.action</span>, <span class="va">method</span> <span class="op">=</span> <span class="st">"qr"</span>, <span class="va">model</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">x</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">y</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">qr</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">singular.ok</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">contrasts</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">offset</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># data:</span></span>
<span>  <span class="co"># - data.frame or named list (a data.frame is a named list, but it is still added for clarity)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"data.frame | named list"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># formula:</span></span>
<span>  <span class="co"># - must be provided by the user (mbt)</span></span>
<span>  <span class="co"># - must be two-sided (ts)</span></span>
<span>  <span class="co"># - variables must be in the data or in the environment [var(data, env)]</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">"ts formula var(data, env) mbt"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># subset:</span></span>
<span>  <span class="co"># - either a logical or an integer vector</span></span>
<span>  <span class="co"># - can be a variable of the data set (eval)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">subset</span>, <span class="st">"eval vector(logical, strict integer)"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># weights:</span></span>
<span>  <span class="co"># - vector of positive integers</span></span>
<span>  <span class="co"># - can be NULL</span></span>
<span>  <span class="co"># - can be a variable of the data set (eval)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">weights</span>, <span class="st">"eval vector numeric GE{0} safe null"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># na.action:</span></span>
<span>  <span class="co"># - can be NULL</span></span>
<span>  <span class="co"># - must be a function with at least one argument</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">na.action</span>, <span class="st">"null function arg(1,)"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># method:</span></span>
<span>  <span class="co"># - either 'qr' or 'model.frame', partially matched</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_set_arg</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"match(qr, model.frame)"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># You can pool arguments of the same type:</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">qr</span>, <span class="va">singular.ok</span>, <span class="st">"logical scalar"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># contrasts:</span></span>
<span>  <span class="co"># - NULL or list</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">contrasts</span>, <span class="st">"null list"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># offset:</span></span>
<span>  <span class="co"># - can be NULL</span></span>
<span>  <span class="co"># - numeric matrix or vector</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">offset</span>, <span class="st">"null numeric vmatrix"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.call.html" class="external-link">match.call</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">mc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">mc</span>, <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And that’s it, now you get very precise error messages if you pass
wrong arguments in <code>lm_check</code>. Note that in terms of function
design, you could require that: i) the user must provide a data.frame,
and ii) all variables in the formula must be in the data.frame. Doing
that, you can save some further error handling down the road:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_check_bis</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">subset</span>, <span class="va">weights</span>, <span class="va">na.action</span>, <span class="va">method</span> <span class="op">=</span> <span class="st">"qr"</span>, <span class="va">model</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">x</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">y</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">qr</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">singular.ok</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">contrasts</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">offset</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># data: now only a data.frame and required</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"data.frame mbt"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># formula: All variables must be in the data</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">formula</span>, <span class="st">"ts formula var(data) mbt"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># subset: =&gt; now we can be more precise</span></span>
<span>  <span class="co"># - if logical: must be of the same length as the data (otherwise it's a mistake)</span></span>
<span>  <span class="co"># - if integer, can be of any length (strict integer is used, because we don't want it to be logical)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">subset</span>, <span class="st">"eval vector strict logical len(data) | vector strict integer"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># weights:vector of positive integers, of the same length as the data</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">weights</span>, <span class="st">"eval vector numeric GE{0} safe null len(data)"</span>, .data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Below: same as before</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">na.action</span>, <span class="st">"null function arg(1,)"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_set_arg</a></span><span class="op">(</span><span class="va">method</span>, <span class="st">"match(qr, model.frame)"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">qr</span>, <span class="va">singular.ok</span>, <span class="st">"logical scalar"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">contrasts</span>, <span class="st">"null list"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># we extract the left hand side (it can be multi response)</span></span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">formula</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># offset:</span></span>
<span>  <span class="co"># - if y is a matrix =&gt; offset must be a matrix of the same number of columns</span></span>
<span>  <span class="fu"><a href="../reference/check_arg.html">check_arg</a></span><span class="op">(</span><span class="va">offset</span>, <span class="st">"null numeric vmatrix ncol(data)"</span>, .data <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">mc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.call.html" class="external-link">match.call</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">mc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">mc</span>, <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Using argument checking when writing functions also shows you
precisely what you expect the user to provide. It can help to design the
code.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Zeileis A, Croissant Y (2010). “Extended Model Formulas in R:
Multiple Parts and Multiple Responses.” <em>Journal of Statistical
Software</em>, 34(1), 1–13. URL <a href="https://www.jstatsoft.org/v34/i01/" class="external-link"></a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
